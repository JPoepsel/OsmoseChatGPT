<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">

<title>Osmose Controller</title>

<link rel="stylesheet" href="style.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>


<body>

<nav>
  <button onclick="show('home')">Home</button>
  <button onclick="show('hist')">History</button>
  <button onclick="show('set')">Settings</button>
</nav>


<!-- ========================================================= -->
<!-- HOME -->
<!-- ========================================================= -->
<section id="home">

<h2 id="state">IDLE</h2>

<div class="grid">
  <div>TDS <b id="tds">0</b></div>
  <div>Liter <b id="liters">0</b></div>
  <div>Flow L/min <b id="flow">0</b></div>
  <div>Rest <b id="left">0</b></div>
</div>

<button class="start" onclick="ws.send('start')">Start</button>
<button class="stop"  onclick="ws.send('stop')">Stop</button>

</section>


<!-- ========================================================= -->
<!-- HISTORY -->
<!-- ========================================================= -->
<section id="hist" hidden>
  <canvas id="chart"></canvas>
</section>



<!-- ========================================================= -->
<!-- SETTINGS  (NEU â€“ komplett) -->
<!-- ========================================================= -->
<section id="set" hidden>

<h3>âš™ Settings</h3>

<div class="settings">

  <label>
    Pulses / Liter IN
    <input id="set_pin" type="number" value="100">
  </label>

  <label>
    Pulses / Liter OUT
    <input id="set_pout" type="number" value="100">
  </label>

  <label>
    Prepare Time (ms)
    <input id="set_prepare" type="number" value="10000">
  </label>

  <label>
    Flush Timeout (ms)
    <input id="set_flush" type="number" value="120000">
  </label>

  <button class="save" onclick="saveSettings()">ðŸ’¾ Save</button>

</div>

</section>



<!-- ========================================================= -->
<script src="app.js"></script>

<script>
function saveSettings(){

  const payload = {
    cmd: "save",

    pin:     Number(set_pin.value),
    pout:    Number(set_pout.value),
    prepare: Number(set_prepare.value),
    flush:   Number(set_flush.value)
  };

  ws.send(JSON.stringify(payload));

  alert("Settings gesendet");
}
</script>


</body>
</html>
